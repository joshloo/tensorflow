load("@bazel_skylib//rules:expand_template.bzl", "expand_template")
load("@llvm-project//llvm:lit_test.bzl", "package_path")
load("test_cases.bzl", "run_hlo_mhlo_tests")

package(
    # copybara:uncomment default_applicable_licenses = ["//tensorflow:license"],
    licenses = ["notice"],
)

# Run hlo_to_mhlo translation tests based on the platform
run_hlo_mhlo_tests(name = "all tests")

# Generates lit config input file by applying path placeholder substitutions
# similar to the configure_lit_site_cfg CMake macro.
expand_template(
    name = "lit_site_cfg_py",
    testonly = True,
    out = "lit.site.cfg.py",
    substitutions = {
        "@LIT_SITE_CFG_IN_HEADER@": "# Autogenerated, do not edit.",
        "@LLVM_TOOLS_DIR@": package_path("@llvm-project//llvm:BUILD"),
        "@SHLIBEXT@": ".so",
        "@ENABLE_SHARED@": "1",
        "@ENABLE_ASSERTIONS@": "1",
        # Separate '@' (reference to main repo) to avoid confusing copybara.
        "@XLA_TRANSLATE_TOOLS_DIR@": package_path("@" + "//xla/translate:BUILD"),
        "@XLA_TRANSLATE_SOURCE_DIR@": package_path("@" + "//xla/translate/hlo_to_mhlo:BUILD"),
    },
    template = "lit.site.cfg.py.in",
    visibility = ["//visibility:private"],
)
